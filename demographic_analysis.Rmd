---
title: "Demographic Analysis"
author: "Simon Hanzal"
date: "11 11 2022"
output: html_document
---
# Setup

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Modify path as needed depending on where the files are stored in your device
path <- r"(C:\Users\hanza\OneDrive\Dokumenty\R)"
# path <- r"(C:\Users\simonha\OneDrive - University of Glasgow\research\data\exp1_data\compilation)"
knitr::opts_knit$set(root.dir = path)
library(tidyverse)
library(readxl)
library(broom)
library(lme4)
```

```{r load, echo=FALSE}
demographic_data <- read_excel("demographic.xlsx")
excluded = c(
    10004, 10006, 10502, 15004, 15508, 15509
)
```


```{r cleaning, echo=FALSE}
demo_clean <- demographic_data %>%
    filter(!is.na(ID)) %>%
    # exclusions
    filter(!ID %in% excluded) %>%
    mutate(age_group = ifelse(age <= 50, "young", "older"))
```

# Description

## Age description 80

``` {r age, echo=FALSE}
age_information <- demo_clean %>%
    group_by(age_group) %>%
    summarise(mean = mean(age), sd = sd(age), median = median(age), min = min(age), max = max(age), number = n())
```

## vas description 80

```{r vas, echo=FALSE}
prevas_information <- demo_clean %>%
    group_by(age_group) %>%
    summarise(mean = mean(`pre-vas`), sd = sd(`pre-vas`), median = median(`pre-vas`), min = min(`pre-vas`), max = max(`pre-vas`), number = n())
prevas_information

postvas_information <- demo_clean %>%
    group_by(age_group) %>%
    summarise(mean = mean(`post-vas`), sd = sd(`post-vas`), median = median(`pre-vas`), min = min(`post-vas`), max = max(`post-vas`), number = n())
postvas_information

vaschange_information <- demo_clean %>%
    group_by(age_group) %>%
    summarise(mean = mean(`dif-vas`), sd = sd(`dif-vas`), median = median(`dif-vas`), min = min(`dif-vas`), max = max(`dif-vas`), number = n())
vaschange_information
```

## vas test 95
```{r}
main_test <- t.test(demo_clean$`pre-vas`, demo_clean$`post-vas`, paired = TRUE)
tidy(main_test)

demo_clean_lm <- demo_clean %>%
    pivot_longer(c(`pre-vas`, `post-vas`), names_to = "timepoint", values_to = "vas") %>%
    mutate(timepoint = recode(timepoint, "pre-vas" = 0, "post-vas" = 1)) %>%
    select(ID, timepoint, vas)

main_test_test <- lmer(timepoint ~ vas + (1 | ID), demo_clean_lm)
summary(main_test_test)
main_test_test

library(afex)
mod <- mixed(timepoint ~ vas + (1 | ID), type=3,method="KR",data=demo_clean_lm) 
mod
```

## vas export 90

```{r}
demo_export <- demo_clean %>%
    mutate(subjective_difference = `dif-vas`) %>%
    select(ID, subjective_difference)

write.csv(demo_export, "subjective_difference.csv")
```


## vas plot 10
Bring from elsewhere