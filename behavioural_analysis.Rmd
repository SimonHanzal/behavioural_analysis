---
title: "Demographic Analysis"
author: "Simon Hanzal"
date: "11 11 2022"
output: html_document
---
# Setup

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Modify path as needed depending on where the files are stored in your device
path <- r"(C:\Users\hanza\OneDrive\Dokumenty\R)"
knitr::opts_knit$set(root.dir = path)
library(tidyverse)
library(readxl)
library(broom)
```

```{r load, echo=FALSE}
trial_data <- read_excel("behavioural.xlsx")
excluded = c(
   10004, 10006, 10502, 15004, 15508, 15509 
)
```

# Removals
## Participant level
```{r cleaning, echo=FALSE}
trial_data <- trial_data %>%
    filter(participant < 16000) %>%
    filter(!is.na(participant)) %>%
    # exclusions
    filter(!participant %in% excluded) %>%
    filter(block >= 1.0 & block <= 8.0) %>%
    mutate(age_group = ifelse(participant >= 10600, "older", "young")) %>%
    group_by(participant) %>%
    mutate(observation = 1:n()+1) %>%
    ungroup()

rt_data <- trial_data %>%
    filter(condition == "Go") %>%
    filter(Stimulus.ACC == 1)

nogo_data <- trial_data %>%
    filter(condition == "NoGo")
```

## Trial level

### Behavioural to Neural

```{r}
behavioural_rejections <- rt_data %>%
  group_by(block, age_group) %>%
  mutate(mean_rt = mean(Stimulus.RT), sd_rt = sd(Stimulus.RT)) %>%
  ungroup() %>%
  select(participant, block, stimulus, age_group, observation, Stimulus.RT, mean_rt, sd_rt) %>%
  filter(Stimulus.RT <= mean_rt-2*sd_rt | Stimulus.RT >= mean_rt+2*sd_rt)
  
behavioural_rejections_intersect <- behavioural_rejections %>%
    select(participant, observation)

behavioural_rt <- rt_data %>%
    anti_join(behavioural_rejections_intersect)
```



### Neural to Behavioural
```{r}
neural_rejections <- read_excel("data_removal_long.xlsx")

neural_rejections_intersect <- neural_rejections %>%
    select(participant, observation)

neural_rt <- behavioural_rt %>%
    inner_join(neural_rejections_intersect)

neural_nogo <- nogo_data %>%
    inner_join(neural_rejections_intersect)

```


# Description

## Assumption check distribution

## Summaries

```{r rt_sum, echo=FALSE}
rt_sum <- neural_rt %>%
  group_by(block, age_group) %>%
  summarise(mean = mean(Stimulus.RT), sd = sd(Stimulus.RT),
            min = min(Stimulus.RT), max = max(Stimulus.RT), trials = n())

# calculate change score
rt_change_sum <- rt_sum
  
# calculate accuracy score more cleverly
summary_nogo2 <- data %>%
  filter(participant < 15000) %>%
  group_by(participant, block) %>%
  filter(condition == "NoGo") %>%
  filter(block >= 1.0) %>%
  count(Stimulus.ACC) %>%
  mutate(proportion = round(n/18,4)) %>%
  filter(Stimulus.ACC == 1) %>%
  mutate(proportion = proportion*100) %>%
  filter(block == 8) %>%
  select(-block) %>%
  select(participant, proportion) %>%
  inner_join(y = summary_nogo, by = "participant") %>%
  mutate(difference = proportion.x - proportion.y)

# calculate accuracy change

# assemble

# has age, vas_change, err_change, rt_change, mean_rt, mean_err and space for alpha_change

all_data <- rt_data
```

# Plotting

# Modelling

## Confirmation t-test for changes
```{r}
# vas change

# rt change

# error change
```


## Main models
```{r}
# error

# error_model <- lm(
# err ~ age * vas change * rt * rt change x ? Error change,
# model_data
#)

# error_change_model <- lm(
# err_change ~ age * vas change * rt * rt change x ? Error,
# model_data
#)
```

```{r}
# Look for brain and behaviour link
#brain_behaviour_model <- lm(vas ~ block_change, model_data)
```


